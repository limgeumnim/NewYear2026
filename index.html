<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 3D Snowball Greeting</title>
    <style>
        body { margin: 0; overflow: hidden; background: radial-gradient(circle, #1a2a6c, #b21f1f, #fdbb2d); font-family: 'Arial', sans-serif; }
        
        /* UI 레이어 */
        #ui {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 40px 0;
            color: white;
            z-index: 10;
        }

        h1 { font-size: 3rem; text-shadow: 0 0 15px rgba(255,255,255,0.8); margin: 0; }
        .instructions { font-size: 1rem; opacity: 0.8; }
        
        .message-box {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 20px 40px;
            border-radius: 50px;
            border: 1px solid rgba(255,255,255,0.3);
            pointer-events: auto;
        }

        #save-btn {
            background: white; color: #b21f1f;
            border: none; padding: 10px 25px;
            border-radius: 20px; font-weight: bold;
            cursor: pointer; margin-top: 10px;
        }
    </style>
</head>
<body>

    <div id="ui">
        <header>
            <h1>2026 Happy New Year</h1>
            <p class="instructions">마우스로 스노우볼을 돌려보세요!</p>
        </header>

        <div class="message-box">
            <div id="greeting">행복한 한 해 되세요!</div>
            <button id="save-btn">이미지 저장하기</button>
        </div>
    </div>

    <!-- Three.js Import -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        let scene, camera, renderer, controls, snow;

        init();
        animate();

        function init() {
            // 1. Scene & Camera
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 15);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true, preserveDrawingBuffer: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            // 2. Lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
            scene.add(ambientLight);

            const pointLight = new THREE.PointLight(0xffffff, 1.5);
            pointLight.position.set(5, 10, 5);
            scene.add(pointLight);

            // 3. Snowball Parts
            const snowballGroup = new THREE.Group();
            scene.add(snowballGroup);

            // A. 나무 받침대 (Cylinder)
            const baseGeo = new THREE.CylinderGeometry(4, 4.5, 1.5, 32);
            const baseMat = new THREE.MeshStandardMaterial({ color: 0x3d2b1f, roughness: 0.8 });
            const base = new THREE.Mesh(baseGeo, baseMat);
            base.position.y = -0.75;
            snowballGroup.add(base);

            // B. 내부 바닥 (눈 덮인 땅)
            const groundGeo = new THREE.CylinderGeometry(3.8, 3.8, 0.2, 32);
            const groundMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
            const ground = new THREE.Mesh(groundGeo, groundMat);
            ground.position.y = 0;
            snowballGroup.add(ground);

            // C. 유리 돔 (Sphere)
            const glassGeo = new THREE.SphereGeometry(4, 32, 32);
            const glassMat = new THREE.MeshPhysicalMaterial({
                color: 0xffffff,
                metalness: 0,
                roughness: 0,
                transmission: 1, // 유리처럼 빛 통과
                thickness: 0.5,
                transparent: true,
                opacity: 0.3,
                envMapIntensity: 1
            });
            const glass = new THREE.Mesh(glassGeo, glassMat);
            glass.position.y = 1.5;
            snowballGroup.add(glass);

            // 4. 내부 장식 (Decorations)
            
            // D. 눈사람 (3 Spheres)
            const snowman = new THREE.Group();
            const snowMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
            
            const bodyBottom = new THREE.Mesh(new THREE.SphereGeometry(0.7, 16, 16), snowMat);
            bodyBottom.position.y = 0.6;
            
            const bodyMid = new THREE.Mesh(new THREE.SphereGeometry(0.5, 16, 16), snowMat);
            bodyMid.position.y = 1.5;
            
            const head = new THREE.Mesh(new THREE.SphereGeometry(0.35, 16, 16), snowMat);
            head.position.y = 2.2;

            // 눈사람 눈 (작은 구)
            const eyeMat = new THREE.MeshBasicMaterial({ color: 0x000000 });
            const eyeL = new THREE.Mesh(new THREE.SphereGeometry(0.04), eyeMat);
            eyeL.position.set(0.1, 2.25, 0.3);
            const eyeR = eyeL.clone();
            eyeR.position.x = -0.1;

            snowman.add(bodyBottom, bodyMid, head, eyeL, eyeR);
            snowman.position.set(-1, 0, 0.5);
            snowballGroup.add(snowman);

            // E. 크리스마스 트리 (Cone)
            function createTree(x, z, scale) {
                const treeGroup = new THREE.Group();
                const leaveMat = new THREE.MeshStandardMaterial({ color: 0x0a5d00 });
                const trunkMat = new THREE.MeshStandardMaterial({ color: 0x4d2902 });

                const trunk = new THREE.Mesh(new THREE.CylinderGeometry(0.15, 0.15, 0.5), trunkMat);
                trunk.position.y = 0.25;
                
                const leaves1 = new THREE.Mesh(new THREE.ConeGeometry(0.8, 1.2, 16), leaveMat);
                leaves1.position.y = 1.0;
                
                const leaves2 = new THREE.Mesh(new THREE.ConeGeometry(0.6, 1, 16), leaveMat);
                leaves2.position.y = 1.6;

                treeGroup.add(trunk, leaves1, leaves2);
                treeGroup.position.set(x, 0, z);
                treeGroup.scale.set(scale, scale, scale);
                return treeGroup;
            }

            snowballGroup.add(createTree(1.2, -1, 1.2));
            snowballGroup.add(createTree(-0.5, -1.5, 0.8));

            // 5. 눈 파티클 (Snow Particles)
            const snowCount = 1000;
            const snowGeo = new THREE.BufferGeometry();
            const snowPos = new Float32Array(snowCount * 3);
            const snowVels = [];

            for (let i = 0; i < snowCount; i++) {
                // 구체 내부 무작위 위치
                const r = Math.random() * 3.7;
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.acos(2 * Math.random() - 1);

                snowPos[i * 3] = r * Math.sin(phi) * Math.cos(theta);
                snowPos[i * 3 + 1] = Math.abs(r * Math.sin(phi) * Math.sin(theta)) + 1;
                snowPos[i * 3 + 2] = r * Math.cos(phi);

                snowVels.push(Math.random() * 0.02 + 0.01);
            }

            snowGeo.setAttribute('position', new THREE.BufferAttribute(snowPos, 3));
            const snowMatPart = new THREE.PointsMaterial({ color: 0xffffff, size: 0.05, transparent: true, opacity: 0.8 });
            snow = new THREE.Points(snowGeo, snowMatPart);
            snowballGroup.add(snow);
            snow.userData.vels = snowVels;

            // 6. Controls
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.autoRotate = true;
            controls.autoRotateSpeed = 1;

            // Resize handle
            window.addEventListener('resize', onWindowResize);
            
            // Save Button
            document.getElementById('save-btn').addEventListener('click', () => {
                renderer.render(scene, camera);
                const dataURL = renderer.domElement.toDataURL('image/png');
                const link = document.createElement('a');
                link.download = '2026_NewYear.png';
                link.href = dataURL;
                link.click();
            });
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);

            // 눈 내리는 효과 애니메이션
            const positions = snow.geometry.attributes.position.array;
            const vels = snow.userData.vels;

            for (let i = 0; i < vels.length; i++) {
                positions[i * 3 + 1] -= vels[i]; // Y축 아래로 이동

                // 바닥에 닿으면 다시 위로 (구체 상단 근처)
                if (positions[i * 3 + 1] < 0.1) {
                    positions[i * 3 + 1] = 4;
                }
            }
            snow.geometry.attributes.position.needsUpdate = true;

            controls.update();
            renderer.render(scene, camera);
        }
    </script>
    
</body>
</html>
